<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Ballpark</title>

  <style>
    #vote-options li{
      cursor: pointer;
      text-color: blue;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>Ballpark</h1>
  <h4><span id="user-count">1</span> connected</h4>

  <h2>Options</h2>
  <ul id="vote-options"></ul>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io.connect('http://localhost');

    socket.on('connected', function(data){
      renderOptions(data.options);
      updateUserCount(data.userCount);
    });

    socket.on('userChange', function(data){
      console.log("user count change message", data);
      updateUserCount(data.userCount);
    });

    var renderOptions = function(options){
      var listEl = document.querySelector('#vote-options');
      var optionEls = document.createDocumentFragment();
      options.forEach(function(option){
        var el = document.createElement('li');
        el.textContent = option;
        optionEls.appendChild(el);
      });
      listEl.appendChild(optionEls);
      addListeners();
    };

    var addListeners = function(){
      var els = document.querySelectorAll('#vote-options li');
      [].forEach.call(els, function(el){
        el.addEventListener('click', function(ev){
          var optionValue = ev.currentTarget.textContent;
          vote(optionValue);
        }, false);
      });
    }

    var vote = function(option){
      socket.emit('vote', {vote: option});
    };

    var updateUserCount = function(count){
      document.getElementById('user-count').textContent = count;
    };
  </script>
</body>
</html>